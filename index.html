<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>小翔翔扫雷</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Comic Sans MS', 'Marker Felt', 'Segoe UI', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #ffd1e3, #a5c5ff, #f7c8e0, #fff2cc);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-x: hidden;
        }
        
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        #main-menu {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            max-width: 600px;
            text-align: center;
            padding: 30px;
        }
        
        .main-logo {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: white;
            border: 5px solid #ff9e6d;
            box-shadow: 0 10px 30px rgba(255, 105, 150, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 30px;
        }
        
        .main-logo img {
            width: 90%;
            height: 90%;
            border-radius: 50%;
            object-fit: cover;
        }
        
        .menu-title {
            font-size: 3rem;
            color: #ff6b9d;
            margin-bottom: 30px;
            text-shadow: 3px 3px 5px rgba(0,0,0,0.2);
            font-weight: bold;
            letter-spacing: 2px;
        }
        
        .menu-options {
            display: flex;
            flex-direction: column;
            gap: 25px;
            width: 100%;
            max-width: 400px;
            margin: 30px 0;
        }
        
        .menu-btn {
            background: linear-gradient(to right, #6dc0ff, #b967ff);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 18px 40px;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(109, 192, 255, 0.4);
            position: relative;
            overflow: hidden;
            z-index: 1;
        }
        
        .menu-btn:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: 0.5s;
        }
        
        .menu-btn:hover:before {
            left: 100%;
        }
        
        .menu-btn:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 25px rgba(109, 192, 255, 0.6);
        }
        
        .menu-btn.play {
            background: linear-gradient(to right, #ff9e6d, #ff6b9d);
        }
        
        .menu-btn.donate {
            background: linear-gradient(to right, #b967ff, #ff6b9d);
        }
        
        /* 赞赏功能样式 */
        .donate-container {
            display: none;
            width: 100%;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            margin-top: 20px;
            animation: fadeIn 0.5s ease;
        }
        
        .donate-buttons {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
        }
        
        .donate-platform {
            background: white;
            border: 4px solid #ff9e6d;
            border-radius: 15px;
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            width: 150px;
        }
        
        .donate-platform:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 15px rgba(255, 158, 109, 0.3);
        }
        
        .donate-platform i {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #ff6b9d;
        }
        
        .donate-qrcode {
            display: none;
            text-align: center;
            margin-top: 20px;
        }
        
        .donate-qrcode img {
            width: 250px;
            height: 250px;
            border-radius: 15px;
            border: 4px solid #ff9e6d;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin: 0 auto 15px;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .donate-title {
            color: #ff6b9d;
            margin-bottom: 25px;
            font-size: 1.8rem;
        }
        
        .donate-label {
            font-size: 1.2rem;
            font-weight: bold;
            color: #ff6b9d;
        }
        
        .footer {
            margin-top: 40px;
            color: #ff6b9d;
            font-size: 1.2rem;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(255,255,255,0.5);
        }
        
        .game-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            box-shadow: 0 15px 35px rgba(255, 150, 200, 0.5);
            overflow: hidden;
            width: 100%;
            max-width: 900px;
            position: relative;
            border: 8px solid #ff85a2;
            display: none;
        }
        
        .header {
            background: linear-gradient(to right, #ff6b9d, #ff9e6d);
            color: white;
            padding: 80px 20px 20px;
            text-align: center;
            border-bottom: 6px solid #ffd166;
            position: relative;
            z-index: 2;
        }
        
        /* 左上角 Logo */
        .game-logo {
            position: absolute;
            top: 15px;
            left: 15px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: white;
            border: 4px solid #ff9e6d;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }
        
        .game-logo img {
            width: 90%;
            height: 90%;
            border-radius: 50%;
            object-fit: cover;
        }
        
        /* 顶部居中返回按钮 */
        .back-btn {
            position: absolute;
            top: 15px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            z-index: 10;
            border: 3px solid #ff9e6d;
            color: #ff6b9d;
            font-size: 1.5rem;
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            transform: translateX(-50%) scale(1.1);
            background: #ffd1dc;
        }
        
        /* 右上角背景音乐 */
        .music-control-container {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 10;
            background: rgba(255, 255, 255, 0.8);
            padding: 6px;
            border-radius: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border: 2px solid #ff9e6d;
            width: 90px;
        }
        
        .music-label {
            color: #ff6b9d;
            font-size: 0.7rem;
            margin-bottom: 3px;
            font-weight: bold;
            text-align: center;
        }
        
        .music-controls {
            display: flex;
            gap: 8px;
            justify-content: center;
        }
        
        .music-btn {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 2px solid #ff9e6d;
            color: #ff6b9d;
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }
        
        .music-btn:hover {
            transform: scale(1.1);
            background: #ffd1dc;
        }
        
        .current-track {
            font-size: 0.7rem;
            color: #ff6b9d;
            margin-top: 3px;
            text-align: center;
            max-width: 80px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        /* 游戏模式选项（难度选择器）向下移动 */
        .difficulty-selector {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 25px; /* 从10px增加到25px，更靠下 */
            flex-wrap: wrap;
            position: relative;
            z-index: 5;
        }
        
        .difficulty-btn {
            background: #ff9e6d;
            color: white;
            border: none;
            border-radius: 25px;
            padding: 8px 18px;
            font-size: 0.95rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(255, 105, 150, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .difficulty-btn:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: 0.5s;
        }
        
        .difficulty-btn:hover:before {
            left: 100%;
        }
        
        .difficulty-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(255, 105, 150, 0.5);
        }
        
        .difficulty-btn.active {
            transform: scale(1.08);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.8);
        }
        
        .easy { background: #ff9e6d; }
        .normal { background: #6dc0ff; }
        .hard { background: #ff6b9d; }
        .expert { background: #b967ff; }
        
        .stats-bar {
            display: flex;
            justify-content: space-between;
            background: #ffd1dc;
            color: #ff6b9d;
            padding: 15px 25px;
            font-size: 1.2rem;
            font-weight: bold;
            border-bottom: 3px solid #ff9e6d;
        }
        
        .stats-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 100px;
        }
        
        .stats-group .label {
            font-size: 0.85rem;
            color: #ff6b9d;
            margin-bottom: 5px;
        }
        
        .restart-btn {
            background: linear-gradient(to bottom, #ff9e6d, #ff6b9d);
            border: none;
            border-radius: 50%;
            width: 55px;
            height: 55px;
            font-size: 1.6rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            box-shadow: 0 5px 15px rgba(255, 105, 150, 0.4);
        }
        
        .restart-btn:hover {
            transform: rotate(360deg) scale(1.1);
            box-shadow: 0 8px 20px rgba(255, 105, 150, 0.6);
        }
        
        .game-board {
            background: #ffeef4;
            padding: 25px;
            display: flex;
            justify-content: center;
            min-height: 400px;
            position: relative;
            overflow: hidden;
        }
        
        .game-board:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><circle cx="20" cy="20" r="3" fill="%23ff9e6d" opacity="0.2"/><circle cx="50" cy="50" r="2" fill="%23ff6b9d" opacity="0.2"/><circle cx="80" cy="80" r="4" fill="%23ffd166" opacity="0.2"/></svg>');
            z-index: 0;
        }
        
        .mine-grid {
            display: grid;
            grid-gap: 3px;
            background: #ffd1dc;
            padding: 8px;
            border-radius: 10px;
            box-shadow: inset 0 0 15px rgba(255, 150, 180, 0.3);
            z-index: 1;
            position: relative;
        }
        
        .cell {
            width: 32px;
            height: 32px;
            background: linear-gradient(to bottom, #ffb7d5, #ff9ec5);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s ease;
            box-shadow: inset 0 -3px 5px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }
        
        .cell:after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 50%;
            background: rgba(255,255,255,0.2);
        }
        
        .cell:hover {
            background: linear-gradient(to bottom, #ffc2dd, #ffaed0);
            transform: translateY(-3px);
        }
        
        .cell.revealed {
            background: #fff5f8;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.05);
        }
        
        .cell.revealed:after {
            display: none;
        }
        
        .cell.flagged::after {
            content: "🚩";
            position: absolute;
            font-size: 18px;
        }
        
        .cell.mine::after {
            content: "💣";
            position: absolute;
            font-size: 18px;
        }
        
        .cell.mine.revealed {
            background: #ff6b6b;
        }
        
        .cell.mine.revealed::after {
            content: "💥";
            font-size: 22px;
        }
        
        .cell-1 { color: #6dc0ff; }
        .cell-2 { color: #7bd97a; }
        .cell-3 { color: #ff6b9d; }
        .cell-4 { color: #b967ff; }
        .cell-5 { color: #ff9e6d; }
        .cell-6 { color: #5ce1e6; }
        .cell-7 { color: #ffd166; }
        .cell-8 { color: #ff85a2; }
        
        .win-message, .lose-message, .help-modal, .records-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            color: white;
            padding: 30px 40px;
            border-radius: 25px;
            text-align: center;
            font-size: 2.2rem;
            z-index: 100;
            display: none;
            box-shadow: 0 0 50px rgba(255, 150, 200, 0.6);
            border: 6px solid #ffd166;
            max-width: 90%;
            width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .win-message h2, .lose-message h2, .help-modal h2, .records-modal h2 {
            font-size: 2.2rem;
            margin-bottom: 20px;
            color: #ff6b9d;
        }
        
        .win-message {
            border-color: #7bd97a;
        }
        
        .lose-message {
            border-color: #ff6b6b;
        }
        
        .help-modal {
            border-color: #6dc0ff;
            text-align: left;
            font-size: 1rem;
        }
        
        .records-modal {
            border-color: #b967ff;
            text-align: left;
            font-size: 1rem;
        }
        
        .help-content, .records-content {
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
        }
        
        .help-modal h3, .records-modal h3 {
            color: #ff6b9d;
            margin: 15px 0 10px;
            font-size: 1.5rem;
        }
        
        .help-modal ul {
            padding-left: 20px;
            margin-bottom: 15px;
        }
        
        .help-modal li {
            margin-bottom: 10px;
            color: #444;
            line-height: 1.5;
        }
        
        .record-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 15px;
            background: rgba(255, 182, 193, 0.2);
            margin-bottom: 10px;
            border-radius: 10px;
            font-weight: bold;
        }
        
        .record-difficulty {
            color: #ff6b9d;
        }
        
        .record-time {
            color: #b967ff;
        }
        
        .message-btn {
            background: linear-gradient(to right, #ff9e6d, #ff6b9d);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 12px 30px;
            font-size: 1.2rem;
            margin-top: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(255, 105, 150, 0.4);
        }
        
        .message-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(255, 105, 150, 0.6);
        }
        
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            padding: 20px;
            background: #fff5f8;
            border-top: 3px solid #ffd1dc;
        }
        
        .action-btn {
            background: linear-gradient(to right, #6dc0ff, #b967ff);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 12px 25px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(109, 192, 255, 0.3);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .action-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(109, 192, 255, 0.5);
        }
        
        .action-btn.help {
            background: linear-gradient(to right, #ff9e6d, #ff6b9d);
        }
        
        .action-btn.records {
            background: linear-gradient(to right, #b967ff, #ff6b9d);
        }
        
        @media (max-width: 768px) {
            .menu-title {
                font-size: 2.2rem;
            }
            
            .menu-btn {
                padding: 15px 30px;
                font-size: 1.3rem;
            }
            
            .main-logo {
                width: 120px;
                height: 120px;
            }
            
            .game-logo {
                width: 50px;
                height: 50px;
            }
            
            .back-btn {
                width: 45px;
                height: 45px;
                font-size: 1.2rem;
            }
            
            .music-control-container {
                width: 80px;
            }
            
            .music-btn {
                width: 28px;
                height: 28px;
                font-size: 0.8rem;
            }
            
            .difficulty-selector {
                margin-top: 20px; /* 移动端适当调整 */
            }
            
            .difficulty-btn {
                padding: 8px 12px;
                font-size: 0.85rem;
            }
            
            .cell {
                width: 25px;
                height: 25px;
                font-size: 14px;
            }
            
            .stats-group {
                min-width: 80px;
                font-size: 1rem;
            }
            
            .restart-btn {
                width: 45px;
                height: 45px;
                font-size: 1.4rem;
            }
            
            .help-modal, .records-modal {
                padding: 20px;
                width: 90%;
            }
            
            .action-btn {
                padding: 10px 15px;
                font-size: 0.95rem;
            }
            
            .donate-platform {
                width: 120px;
            }
            
            .donate-qrcode img {
                width: 200px;
                height: 200px;
            }
        }
    </style>
</head>
<body>
    <!-- 主菜单 -->
    <div id="main-menu">
        <div class="main-logo">
            <img src="https://raw.githubusercontent.com/hwx0725/saolei/main/IMG_6541.jpeg" alt="小翔翔扫雷Logo">
        </div>
        
        <h1 class="menu-title">小翔翔扫雷</h1>
        
        <div class="menu-options">
            <button class="menu-btn play" id="play-btn">
                <i class="fas fa-play-circle"></i> 开始游戏
            </button>
            
            <button class="menu-btn donate" id="donate-btn">
                <i class="fas fa-heart"></i> 赞赏我吧
            </button>
        </div>
        
        <!-- 赞赏容器 -->
        <div class="donate-container" id="donate-container">
            <h2 class="donate-title">感谢您的支持！</h2>
            
            <!-- 赞赏平台选择 -->
            <div class="donate-buttons">
                <div class="donate-platform" id="wechat-donate">
                    <i class="fab fa-weixin"></i>
                    <div class="donate-label">微信</div>
                </div>
                <div class="donate-platform" id="alipay-donate">
                    <i class="fab fa-alipay"></i>
                    <div class="donate-label">支付宝</div>
                </div>
            </div>
            
            <!-- 二维码显示区域 -->
            <div class="donate-qrcode" id="wechat-qrcode">
                <img src="https://raw.githubusercontent.com/hwx0725/saolei/main/IMG_6831.jpeg" alt="微信赞赏">
                <div class="donate-label">微信扫码赞赏</div>
            </div>
            <div class="donate-qrcode" id="alipay-qrcode">
                <img src="https://raw.githubusercontent.com/hwx0725/saolei/main/IMG_6836.jpeg" alt="支付宝赞赏">
                <div class="donate-label">支付宝扫码赞赏</div>
            </div>
        </div>
        
        <div class="footer">
            2025 小翔翔小游戏
        </div>
    </div>
    
    <!-- 游戏界面 -->
    <div class="game-container" id="game-container">
        <!-- 左上角logo -->
        <div class="game-logo">
            <img src="https://raw.githubusercontent.com/hwx0725/saolei/main/IMG_6541.jpeg" alt="小翔翔扫雷Logo">
        </div>
        
        <!-- 顶部居中返回按钮 -->
        <div class="back-btn" id="back-btn">
            <i class="fas fa-home"></i>
        </div>
        
        <!-- 右上角背景音乐 -->
        <div class="music-control-container">
            <div class="music-label">背景音乐</div>
            <div class="music-controls">
                <div class="music-btn" id="music-control">
                    <i class="fas fa-play"></i>
                </div>
                <div class="music-btn" id="next-music">
                    <i class="fas fa-step-forward"></i>
                </div>
            </div>
            <div class="current-track" id="current-track">歌曲1</div>
        </div>
        
        <div class="header">
            <!-- 游戏模式选项（已向下移动） -->
            <div class="difficulty-selector">
                <button class="difficulty-btn easy active" data-difficulty="easy">简单</button>
                <button class="difficulty-btn normal" data-difficulty="normal">普通</button>
                <button class="difficulty-btn hard" data-difficulty="hard">复杂</button>
                <button class="difficulty-btn expert" data-difficulty="expert">困难</button>
            </div>
        </div>
        
        <div class="stats-bar">
            <div class="stats-group">
                <div class="label">剩余地雷</div>
                <div id="mines-remaining">0</div>
            </div>
            
            <div class="center-group">
                <button class="restart-btn">↻</button>
            </div>
            
            <div class="stats-group">
                <div class="label">用时</div>
                <div id="time">0秒</div>
            </div>
        </div>
        
        <div class="game-board">
            <div class="mine-grid" id="mine-grid"></div>
        </div>
        
        <div class="action-buttons">
            <button class="action-btn help" id="help-btn">
                <i class="fas fa-question-circle"></i> 游戏说明
            </button>
            <button class="action-btn records" id="records-btn">
                <i class="fas fa-trophy"></i> 最佳记录
            </button>
        </div>
    </div>
    
    <!-- 游戏弹窗 -->
    <div class="win-message" id="win-message">
        <h2>恭喜！你赢了！🎉</h2>
        <p>用时: <span id="win-time">0</span>秒</p>
        <button class="message-btn" id="play-again-win">再玩一次</button>
    </div>
    
    <div class="lose-message" id="lose-message">
        <h2>很遗憾！你输了！💥</h2>
        <p>坚持了: <span id="lose-time">0</span>秒</p>
        <button class="message-btn" id="play-again-lose">再试一次</button>
    </div>
    
    <div class="help-modal" id="help-modal">
        <h2>游戏说明</h2>
        <div class="help-content">
            <h3>游戏规则</h3>
            <ul>
                <li><strong>左键点击</strong> - 翻开格子</li>
                <li><strong>右键点击</strong> - 标记/取消标记地雷（插旗）</li>
                <li><strong>数字</strong> - 表示周围8格中的地雷数量</li>
                <li><strong>目标</strong> - 翻开所有非地雷格子</li>
                <li>翻开地雷即告失败，标记所有地雷且翻开所有安全格子则获胜</li>
            </ul>
            
            <h3>游戏技巧</h3>
            <ul>
                <li>从数字小的区域开始，逐步推理周边地雷位置</li>
                <li>当数字周围已标记足够数量的地雷时，可安全翻开剩余格子</li>
                <li>无法确定时，可先标记可能存在地雷的区域</li>
                <li>利用角落和边缘的信息进行推理</li>
            </ul>
        </div>
        <button class="message-btn" id="close-help">关闭</button>
    </div>
    
    <div class="records-modal" id="records-modal">
        <h2>最佳记录</h2>
        <div class="records-content">
            <div class="record-list" id="record-list">
                <div class="record-item">
                    <span class="record-difficulty">简单模式：</span>
                    <span class="record-time" id="best-easy">--</span>
                </div>
                <div class="record-item">
                    <span class="record-difficulty">普通模式：</span>
                    <span class="record-time" id="best-normal">--</span>
                </div>
                <div class="record-item">
                    <span class="record-difficulty">复杂模式：</span>
                    <span class="record-time" id="best-hard">--</span>
                </div>
                <div class="record-item">
                    <span class="record-difficulty">困难模式：</span>
                    <span class="record-time" id="best-expert">--</span>
                </div>
            </div>
        </div>
        <button class="message-btn" id="close-records">关闭</button>
    </div>

    <script>
        // 游戏配置
        const difficulties = {
            easy: { rows: 9, cols: 9, mines: 10 },
            normal: { rows: 16, cols: 16, mines: 40 },
            hard: { rows: 16, cols: 30, mines: 99 },
            expert: { rows: 24, cols: 30, mines: 180 }
        };
        
        // 背景音乐列表
        const musicList = [
            {name: "爱爱爱", url: 'https://raw.githubusercontent.com/hwx0725/saolei/main/aiaiai.mp3'},
            {name: "爱在", url: 'https://raw.githubusercontent.com/hwx0725/saolei/main/aizai.mp3'},
            {name: "才二十三", url: 'https://raw.githubusercontent.com/hwx0725/xiaolizi/main/ershi.mp3'},
            {name: "回留", url: 'https://raw.githubusercontent.com/hwx0725/saolei/main/huiliu.mp3'},
            {name: "因为你", url: 'https://raw.githubusercontent.com/hwx0725/saolei/main/yinweini.mp3'}
        ];
        
        // 游戏状态
        let gameState = {
            difficulty: 'easy',
            grid: [],
            mines: [],
            revealedCount: 0,
            flaggedCount: 0,
            gameOver: false,
            gameWon: false,
            timer: 0,
            timerInterval: null,
            firstClick: true,
            bestRecords: {
                easy: null,
                normal: null,
                hard: null,
                expert: null
            }
        };
        
        // 音乐状态
        let musicState = {
            audio: null,
            isPlaying: false,
            currentTrack: 0
        };
        
        // DOM元素
        const mainMenu = document.getElementById('main-menu');
        const gameContainer = document.getElementById('game-container');
        const playBtn = document.getElementById('play-btn');
        const donateBtn = document.getElementById('donate-btn');
        const donateContainer = document.getElementById('donate-container');
        const wechatDonate = document.getElementById('wechat-donate');
        const alipayDonate = document.getElementById('alipay-donate');
        const wechatQrcode = document.getElementById('wechat-qrcode');
        const alipayQrcode = document.getElementById('alipay-qrcode');
        const backBtn = document.getElementById('back-btn');
        const mineGrid = document.getElementById('mine-grid');
        const minesRemaining = document.getElementById('mines-remaining');
        const timeElement = document.getElementById('time');
        const winMessage = document.getElementById('win-message');
        const loseMessage = document.getElementById('lose-message');
        const winTime = document.getElementById('win-time');
        const loseTime = document.getElementById('lose-time');
        const musicControl = document.getElementById('music-control');
        const nextMusic = document.getElementById('next-music');
        const currentTrack = document.getElementById('current-track');
        const bestEasy = document.getElementById('best-easy');
        const bestNormal = document.getElementById('best-normal');
        const bestHard = document.getElementById('best-hard');
        const bestExpert = document.getElementById('best-expert');
        const helpModal = document.getElementById('help-modal');
        const recordsModal = document.getElementById('records-modal');
        const helpBtn = document.getElementById('help-btn');
        const recordsBtn = document.getElementById('records-btn');
        const closeHelp = document.getElementById('close-help');
        const closeRecords = document.getElementById('close-records');
        
        // 初始化游戏
        function init() {
            // 隐藏所有二维码
            wechatQrcode.style.display = 'none';
            alipayQrcode.style.display = 'none';
            updatePlayerStats();
            setupEventListeners();
        }
        
        // 更新玩家状态显示
        function updatePlayerStats() {
            // 加载最佳记录
            loadBestRecords();
        }
        
        // 设置事件监听器
        function setupEventListeners() {
            // 主菜单切换
            playBtn.addEventListener('click', showGameView);
            backBtn.addEventListener('click', showMainMenu);
            
            // 赞赏功能
            donateBtn.addEventListener('click', () => {
                donateContainer.style.display = donateContainer.style.display === 'none' ? 'block' : 'none';
                // 重置二维码显示
                wechatQrcode.style.display = 'none';
                alipayQrcode.style.display = 'none';
            });
            
            // 微信赞赏
            wechatDonate.addEventListener('click', () => {
                wechatQrcode.style.display = 'block';
                alipayQrcode.style.display = 'none';
            });
            
            // 支付宝赞赏
            alipayDonate.addEventListener('click', () => {
                alipayQrcode.style.display = 'block';
                wechatQrcode.style.display = 'none';
            });
            
            // 难度选择
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    initGame(btn.dataset.difficulty);
                });
            });
            
            // 重新开始
            document.querySelector('.restart-btn').addEventListener('click', () => {
                initGame(gameState.difficulty);
            });
            
            // 游戏结果处理
            document.getElementById('play-again-win').addEventListener('click', () => {
                winMessage.style.display = 'none';
                initGame(gameState.difficulty);
            });
            
            document.getElementById('play-again-lose').addEventListener('click', () => {
                loseMessage.style.display = 'none';
                initGame(gameState.difficulty);
            });
            
            // 音乐控制
            musicControl.addEventListener('click', toggleMusic);
            nextMusic.addEventListener('click', nextTrack);
            
            // 帮助和记录
            helpBtn.addEventListener('click', () => {
                helpModal.style.display = 'block';
            });
            
            recordsBtn.addEventListener('click', () => {
                recordsModal.style.display = 'block';
            });
            
            closeHelp.addEventListener('click', () => {
                helpModal.style.display = 'none';
            });
            
            closeRecords.addEventListener('click', () => {
                recordsModal.style.display = 'none';
            });
            
            // 点击模态框外部关闭
            window.addEventListener('click', (e) => {
                if (e.target === helpModal) helpModal.style.display = 'none';
                if (e.target === recordsModal) recordsModal.style.display = 'none';
            });
        }
        
        // 初始化游戏
        function initGame(difficulty) {
            gameState.difficulty = difficulty;
            gameState.revealedCount = 0;
            gameState.flaggedCount = 0;
            gameState.gameOver = false;
            gameState.gameWon = false;
            gameState.firstClick = true;
            gameState.timer = 0;
            
            // 重置计时器
            clearInterval(gameState.timerInterval);
            timeElement.textContent = '0秒';
            
            // 设置难度
            const { rows, cols, mines } = difficulties[difficulty];
            gameState.minesCount = mines;
            minesRemaining.textContent = mines;
            
            // 创建网格
            createGrid(rows, cols);
            
            // 更新按钮状态
            updateDifficultyButtons(difficulty);
        }
        
        // 创建网格
        function createGrid(rows, cols) {
            mineGrid.innerHTML = '';
            mineGrid.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
            
            gameState.grid = [];
            
            for (let r = 0; r < rows; r++) {
                gameState.grid[r] = [];
                for (let c = 0; c < cols; c++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.row = r;
                    cell.dataset.col = c;
                    
                    // 添加事件监听器
                    cell.addEventListener('click', () => handleCellClick(r, c));
                    cell.addEventListener('contextmenu', (e) => {
                        e.preventDefault();
                        handleRightClick(r, c);
                    });
                    
                    mineGrid.appendChild(cell);
                    gameState.grid[r][c] = {
                        isMine: false,
                        isRevealed: false,
                        isFlagged: false,
                        neighborCount: 0,
                        element: cell
                    };
                }
            }
        }
        
        // 处理单元格点击
        function handleCellClick(row, col) {
            if (gameState.gameOver || gameState.grid[row][col].isRevealed || gameState.grid[row][col].isFlagged) {
                return;
            }
            
            // 第一次点击 - 开始计时并生成地雷
            if (gameState.firstClick) {
                startTimer();
                placeMines(row, col);
                gameState.firstClick = false;
            }
            
            const cell = gameState.grid[row][col];
            
            if (cell.isMine) {
                // 点到地雷 - 游戏结束
                revealMines();
                cell.element.classList.add('revealed', 'mine');
                gameOver(false);
                return;
            }
            
            // 翻开单元格
            revealCell(row, col);
            
            // 检查是否获胜
            checkWin();
        }
        
        // 处理右键点击
        function handleRightClick(row, col) {
            if (gameState.gameOver || gameState.grid[row][col].isRevealed) {
                return;
            }
            
            const cell = gameState.grid[row][col];
            
            if (!cell.isFlagged) {
                // 标记旗帜
                cell.isFlagged = true;
                cell.element.classList.add('flagged');
                gameState.flaggedCount++;
            } else {
                // 移除标记
                cell.isFlagged = false;
                cell.element.classList.remove('flagged');
                gameState.flaggedCount--;
            }
            
            // 更新剩余地雷数
            minesRemaining.textContent = gameState.minesCount - gameState.flaggedCount;
        }
        
        // 放置地雷
        function placeMines(firstRow, firstCol) {
            const { rows, cols, mines } = difficulties[gameState.difficulty];
            let minesPlaced = 0;
            
            gameState.mines = [];
            
            while (minesPlaced < mines) {
                const r = Math.floor(Math.random() * rows);
                const c = Math.floor(Math.random() * cols);
                
                // 确保第一次点击的位置不是地雷，并且周围也没有地雷
                if ((r === firstRow && c === firstCol) || 
                    (Math.abs(r - firstRow) <= 1 && Math.abs(c - firstCol) <= 1)) {
                    continue;
                }
                
                if (!gameState.grid[r][c].isMine) {
                    gameState.grid[r][c].isMine = true;
                    gameState.mines.push({ row: r, col: c });
                    minesPlaced++;
                    
                    // 更新周围格子的计数
                    updateNeighborCounts(r, c);
                }
            }
        }
        
        // 更新邻居计数
        function updateNeighborCounts(row, col) {
            for (let r = Math.max(0, row - 1); r <= Math.min(gameState.grid.length - 1, row + 1); r++) {
                for (let c = Math.max(0, col - 1); c <= Math.min(gameState.grid[0].length - 1, col + 1); c++) {
                    if (!(r === row && c === col)) {
                        gameState.grid[r][c].neighborCount++;
                    }
                }
            }
        }
        
        // 翻开单元格
        function revealCell(row, col) {
            const cell = gameState.grid[row][col];
            
            if (cell.isRevealed || cell.isFlagged) {
                return;
            }
            
            cell.isRevealed = true;
            cell.element.classList.add('revealed');
            gameState.revealedCount++;
            
            if (cell.neighborCount > 0) {
                cell.element.textContent = cell.neighborCount;
                cell.element.classList.add(`cell-${cell.neighborCount}`);
            } else {
                // 如果是0，则递归翻开周围的单元格
                for (let r = Math.max(0, row - 1); r <= Math.min(gameState.grid.length - 1, row + 1); r++) {
                    for (let c = Math.max(0, col - 1); c <= Math.min(gameState.grid[0].length - 1, col + 1); c++) {
                        if (!(r === row && c === col)) {
                            revealCell(r, c);
                        }
                    }
                }
            }
        }
        
        // 开始计时
        function startTimer() {
            gameState.timer = 0;
            clearInterval(gameState.timerInterval);
            
            gameState.timerInterval = setInterval(() => {
                gameState.timer++;
                timeElement.textContent = `${gameState.timer}秒`;
            }, 1000);
        }
        
        // 检查是否获胜
        function checkWin() {
            const { rows, cols, mines } = difficulties[gameState.difficulty];
            const totalCells = rows * cols;
            
            if (gameState.revealedCount === totalCells - mines) {
                gameWon();
            }
        }
        
        // 游戏胜利
        function gameWon() {
            gameState.gameOver = true;
            gameState.gameWon = true;
            clearInterval(gameState.timerInterval);
            
            // 标记所有地雷
            for (const mine of gameState.mines) {
                gameState.grid[mine.row][mine.col].element.classList.add('flagged');
            }
            
            winTime.textContent = gameState.timer;
            winMessage.style.display = 'block';
            
            // 更新最佳记录
            updateBestRecord(gameState.difficulty, gameState.timer);
        }
        
        // 游戏结束
        function gameOver(isWin) {
            gameState.gameOver = true;
            clearInterval(gameState.timerInterval);
            
            if (!isWin) {
                loseTime.textContent = gameState.timer;
                loseMessage.style.display = 'block';
            }
        }
        
        // 显示所有地雷
        function revealMines() {
            for (const mine of gameState.mines) {
                const cell = gameState.grid[mine.row][mine.col];
                if (!cell.isFlagged) {
                    cell.element.classList.add('revealed', 'mine');
                }
            }
        }
        
        // 更新难度按钮状态
        function updateDifficultyButtons(difficulty) {
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.difficulty === difficulty) {
                    btn.classList.add('active');
                }
            });
        }
        
        // 加载最佳记录
        function loadBestRecords() {
            const records = JSON.parse(localStorage.getItem('mineSweeperRecords')) || {};
            
            // 更新游戏状态
            gameState.bestRecords.easy = records.easy || null;
            gameState.bestRecords.normal = records.normal || null;
            gameState.bestRecords.hard = records.hard || null;
            gameState.bestRecords.expert = records.expert || null;
            
            // 更新UI
            bestEasy.textContent = gameState.bestRecords.easy ? `${gameState.bestRecords.easy}秒` : '--';
            bestNormal.textContent = gameState.bestRecords.normal ? `${gameState.bestRecords.normal}秒` : '--';
            bestHard.textContent = gameState.bestRecords.hard ? `${gameState.bestRecords.hard}秒` : '--';
            bestExpert.textContent = gameState.bestRecords.expert ? `${gameState.bestRecords.expert}秒` : '--';
        }
        
        // 更新最佳记录
        function updateBestRecord(difficulty, time) {
            if (!gameState.bestRecords[difficulty] || time < gameState.bestRecords[difficulty]) {
                gameState.bestRecords[difficulty] = time;
                
                // 保存到localStorage
                localStorage.setItem('mineSweeperRecords', JSON.stringify(gameState.bestRecords));
                
                // 更新UI
                loadBestRecords();
            }
        }
        
        // 初始化背景音乐
        function initMusic() {
            musicState.audio = new Audio();
            musicState.audio.loop = true;
            musicState.audio.volume = 0.5;
            loadTrack(musicState.currentTrack);
        }
        
        // 加载指定音轨
        function loadTrack(index) {
            musicState.currentTrack = index;
            const track = musicList[index];
            musicState.audio.src = track.url;
            currentTrack.textContent = track.name;
            
            if (musicState.isPlaying) {
                musicState.audio.play().catch(e => {
                    console.error("音乐播放失败:", e);
                });
            }
        }
        
        // 切换音乐播放状态
        function toggleMusic() {
            if (!musicState.audio) {
                initMusic();
            }
            
            if (musicState.isPlaying) {
                musicState.audio.pause();
                musicControl.innerHTML = '<i class="fas fa-play"></i>';
            } else {
                musicState.audio.play()
                    .then(() => {
                        musicControl.innerHTML = '<i class="fas fa-pause"></i>';
                    })
                    .catch(e => {
                        console.error("音乐播放失败:", e);
                        alert("音乐播放失败，请确保您有网络连接并允许音频播放");
                    });
            }
            
            musicState.isPlaying = !musicState.isPlaying;
        }
        
        // 切换到下一首
        function nextTrack() {
            if (!musicState.audio) {
                initMusic();
            }
            
            const nextIndex = (musicState.currentTrack + 1) % musicList.length;
            loadTrack(nextIndex);
        }
        
        // 切换视图
        function showGameView() {
            mainMenu.style.display = 'none';
            gameContainer.style.display = 'block';
            initGame('easy');
        }
        
        function showMainMenu() {
            gameContainer.style.display = 'none';
            mainMenu.style.display = 'flex';
            donateContainer.style.display = 'none';
        }
        
        // 启动游戏
        init();
    </script>
</body>
</html>
